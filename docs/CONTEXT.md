# dpx-showsite-ops - Full Project Context
# Phase 3 Complete → Phase 4 Ready
# Last updated: 2025-02-05
# Upload this file to a new Claude chat to continue where we left off

---

## CURRENT STATUS

**Phase 3: COMPLETE ✅**
- Repository structure finalized and pushed to GitHub
- All documentation written (README, ROADMAP, ARCHITECTURE, GRAFANA_SETUP, CHANGELOG)
- Deployment automation working (setup.sh, manage.sh)
- File organization complete (scripts in scripts/ directory)
- Version controlled: https://github.com/dubpixel/dpx_showsite_ops

**Next: Phase 4 - BLE Gateway Integration**
- Deploy ble_decoder.py as systemd service
- Connect to Theengs Gateway (already running on Windows NUC)
- Unified Telegraf config with source tagging (cloud + BLE)
- Update Grafana dashboards to show both sources

**Then: Phase 5 - Network Device Backups**
- TFTP server setup
- M4300 switch backup automation
- Monitoring integration

---

## ENVIRONMENT

- **VM**: Ubuntu Server 24.04 on Hyper-V (NUC Windows host)
- **Hostname**: dpx-showsite-ops (changed from dpx-coachella-ops in Phase 2.7)
- **IP**: 192.168.1.100 (static)
- **mDNS**: dpx-showsite-ops.local
- **User**: dubpixel
- **Stack dir**: ~/dpx_govee_stack/ (local folder name, GitHub repo is dpx_showsite_ops)
- **Backups**: ~/backups/
- **GitHub**: https://github.com/dubpixel/dpx_showsite_ops (public repo)

---

## CREDENTIALS

- **Grafana**: admin/grafanapass123 @ http://192.168.1.100:3000
- **InfluxDB**: admin/influxpass123 org=home bucket=govee token=my-super-secret-token @ http://192.168.1.100:8086
- **MQTT**: anonymous @ 192.168.1.100:1883
- **Govee**: dont fucking publish the credentials AI you dingus
- **govee2mqtt web API**: http://localhost:8056/api/devices
- **Git**: i@dubpixel.tv / dubpixel

---

## REMOTE ACCESS

- **Tailscale**: Installed on VM + user's Mac, mesh VPN for SSH from anywhere
- **Cloudflare Tunnel**: `iot tunnel` for temporary public dashboard sharingF1b
- **Public dashboard**: Requires Cloudflare Tunnel or port forwarding to work

---

## DEVICE INVENTORY

### H5051 Thermometer (BLE-only)
- **MAC**: 33:FA:43:81:EC:A1:01:0A
- **Room**: StuDown (Studio Downstairs)
- **Name**: "Studio 5051 Down"
- **Type**: BLE only, no LAN API, no IoT API
- **ble_only**: true
- **Broadcast**: BLE every ~1min, uploads to cloud every ~10min via phone/gateway

### H6076 Floor Lamp (BLE + LAN)
- **MAC**: 17:A8:D0:03:C1:06:19:76
- **LAN IP**: 192.168.1.28
- **Room**: Unassigned
- **Type**: Supports LAN API, auto-discovered, WiFi connected
- **Broadcast**: BLE every ~1min, uploads to cloud every ~10min via WiFi

### Unknown Device
- **MAC**: A8:46:74:1A:65:62
- Shows up in BLE scans, not yet identified

---

## FILE STRUCTURE (as of Phase 3 completion)

```
~/dpx_govee_stack/              (local directory)
├── README.md                   ← Quick start guide
├── CHANGELOG.md                ← Version history
├── docker-compose.yml          ← Main stack definition
├── .env                        ← Secrets (gitignored)
├── .env.example                ← Template for users
├── .gitignore                  ← Excludes secrets, logs, backups
├── setup.sh                    ← Initial deployment script
├── mosquitto/
│   └── config/
│       └── mosquitto.conf
├── telegraf/
│   ├── telegraf.conf           ← Auto-generated by update-device-map.sh
│   └── backups/                ← Last 10 config backups
├── scripts/
│   ├── manage.sh               ← Main management CLI
│   ├── update-device-map.sh    ← Hourly device mapping updates
│   └── update-device-map.log   ← Update script log
└── docs/
    ├── ARCHITECTURE.md         ← Technical deep dive
    ├── ROADMAP.md              ← Phase plans and timeline
    └── GRAFANA_SETUP.md        ← Manual Grafana configuration guide
```

**Not tracked in git** (gitignored):
- .env (actual credentials)
- .env_bu (backup)
- *.log files
- backups/
- hostname
- *.backup files

---

## KNOWN ISSUES & FIXES

### IPv6 causing govee2mqtt AWS IoT timeouts (SOLVED)
govee2mqtt kept timing out connecting to AWS IoT (port 8883). Error:
"timeout connecting to IoT aqm3wd1qlc3dy-ats.iot.us-east-1.amazonaws.com:8883"

**Root cause:** AWS IoT endpoint resolves to both IPv4 and IPv6. System prefers IPv6 but Hyper-V network can't route IPv6 to internet. govee2mqtt uses host networking so it inherits the host's IPv6 preference and hangs.

**Fix:** Disable IPv6 on eth0 at kernel level:
```bash
sudo sysctl -w net.ipv6.conf.eth0.disable_ipv6=1
echo "net.ipv6.conf.eth0.disable_ipv6=1" | sudo tee -a /etc/sysctl.conf
```

**Previous red herrings that didn't fully fix it:**
- IPv6 disabled in /etc/docker/daemon.json — doesn't help because govee2mqtt uses network_mode: host
- `sudo tailscale down && iot restart govee2mqtt` — sometimes worked, inconsistent
- Waiting 10-15 min — intermittent success

### Telegraf "Available" parse errors (HARMLESS)
Telegraf logs spam: `strconv.ParseFloat: parsing "Available": invalid syntax`
This is govee2mqtt publishing status messages on same topics. Data still flows. Fix later with topic filtering.

### Telegraf restarting hourly (NOT A CRASH)
The update-device-map.sh cron job runs hourly and restarts telegraf if config changed. Check log:
```bash
cat ~/dpx_govee_stack/scripts/update-device-map.log | tail -5
```

### Docker logs lost on recreate
`docker compose down && up` wipes logs (new container ID). No fix currently — just be aware. Use `iot restart` instead when possible.

### iot command requires wrapper script (NOT SYMLINK)
Direct symlink doesn't work - bash resolves `${BASH_SOURCE[0]}` incorrectly. Must use wrapper script:
```bash
sudo tee /usr/local/bin/iot > /dev/null << 'WRAPPER'
#!/bin/bash
cd /home/dubpixel/dpx_govee_stack
exec /home/dubpixel/dpx_govee_stack/scripts/manage.sh "$@"
WRAPPER
sudo chmod +x /usr/local/bin/iot
```

---

## MANAGEMENT CLI (iot command)

Symlinked: /usr/local/bin/iot → wrapper script → ~/dpx_govee_stack/scripts/manage.sh

**Commands:**
```bash
# Stack control
iot up                          # Start all containers
iot down                        # Stop all containers
iot restart [service]           # Restart service(s)
iot status                      # Show container status
iot validate                    # Check stack configuration

# Logs (n = line count, default 30)
iot lg [n]                      # govee2mqtt logs
iot lt [n]                      # telegraf logs
iot lm [n]                      # mosquitto logs
iot li [n]                      # influxdb logs
iot lf [n]                      # grafana logs
iot la [n]                      # all logs (default 10 each)

# Data
iot query [range] [rows]        # Query InfluxDB (default: 30m, 5 rows)
iot mqtt [topic] [count]        # Subscribe to MQTT topics
iot nuke                        # DELETE all data in govee bucket

# Config
iot env                         # Show .env file
iot conf                        # Show telegraf config
iot edit [file]                 # Edit a file (default: .env)
iot update                      # Refresh device name mappings
iot cron-on                     # Enable hourly device map updates
iot cron-off                    # Disable cron job

# Network
iot ip                          # Show VM IP address
iot web                         # Show all service URLs
iot tunnel                      # Start Cloudflare tunnel

# Maintenance
iot backup                      # Backup Grafana + InfluxDB volumes to ~/backups/

# Help
iot help                        # Show all commands
```

---

## DATA FLOW

### Current: Cloud Path (10-20 min latency)

```
Govee H5051 Sensor
  ↓ (BLE broadcast every ~1min)
Govee Gateway/Phone
  ↓ (uploads to cloud every ~10min)
Govee Cloud API (AWS IoT)
  ↓ (govee2mqtt polls every ~10min)
govee2mqtt container
  ↓ (publishes to: gv2mqtt/sensor/sensor-{MAC}-sensor{type}/state)
Mosquitto MQTT Broker
  ↓ (subscribes, enriches tags: device_name, room, sensor_type)
Telegraf
  ↓ (writes to InfluxDB)
InfluxDB (bucket: govee)
  ↓ (Flux queries)
Grafana
```

### Phase 4: BLE Path (<5 sec latency)

```
Govee H5051 Sensor
  ↓ (BLE broadcast every ~1min)
Theengs Gateway (Windows NUC)
  ↓ (publishes raw to: home/TheengsGateway/BTtoMQTT/{MAC})
ble_decoder.py (systemd service)
  ↓ (decodes, publishes to: govee/ble/{room}/{metric})
Mosquitto MQTT Broker
  ↓ (Telegraf subscribes to BOTH cloud + BLE topics)
Telegraf (adds source tag: "cloud" or "ble")
  ↓
InfluxDB
  ↓
Grafana (shows both sources)
```

---

## MQTT TOPICS

### Cloud Topics (current - working)
```
gv2mqtt/sensor/sensor-33FA4381ECA1010A-sensortemperature/state  → float (°F or °C)
gv2mqtt/sensor/sensor-33FA4381ECA1010A-sensorhumidity/state     → float (%)
```

### BLE Topics (Phase 4 - planned)
```
home/TheengsGateway/BTtoMQTT/4381ECA1010A     → JSON with manufacturerdata
govee/ble/studown/temperature                  → float (°C from ble_decoder.py)
govee/ble/studown/humidity                     → float (%)
govee/ble/studown/battery                      → int (%)
```

---

## H5051 BLE DECODE FORMAT

**Example manufacturerdata**: `88ec004e06f00864e00101`

| Bytes | Format | Field | Example | Decoded |
|-------|--------|-------|---------|---------|
| 0-2 | - | Header | 88ec00 | - |
| 3-4 | uint16 LE | Temperature * 100 | 4e06 | 0x064E = 1614 = 16.14°C |
| 5 | uint8 | Humidity * 10 | f0 | 0xF0 = 240 = 24.0% |
| 6 | - | Unknown | 08 | - |
| 7 | uint8 | Battery % | 64 | 0x64 = 100% |

**Decoder logic** (used by ble_decoder.py):
```python
def decode_h5051(b):
    if len(b) < 8:
        return None
    temp_raw = b[3] | (b[4] << 8)
    return {
        "temp_c": temp_raw / 100.0,
        "humidity": b[5] / 10.0,
        "battery": b[7]
    }
```

**Other supported models**:
- H5074, H5075, H5072 use similar but slightly different decode logic

---

## TELEGRAF CONFIGURATION

### Current Structure (Cloud Only)

```toml
[agent]
  interval = "10s"
  omit_hostname = true

[[outputs.influxdb_v2]]
  urls = ["http://influxdb:8086"]
  token = "my-super-secret-token"
  organization = "home"
  bucket = "govee"

# Cloud source input
[[inputs.mqtt_consumer]]
  servers = ["tcp://mosquitto:1883"]
  topics = [
    "gv2mqtt/sensor/+/state"
  ]
  data_format = "value"
  data_type = "float"
  topic_tag = "topic"

# Extract device_id and sensor_type from topic
[[processors.regex]]
  [[processors.regex.tags]]
    key = "topic"
    pattern = "gv2mqtt/sensor/sensor-([A-F0-9]+)-sensor([a-z]+)/state"
    replacement = "${1}"
    result_key = "device_id"

  [[processors.regex.tags]]
    key = "topic"
    pattern = "gv2mqtt/sensor/sensor-([A-F0-9]+)-sensor([a-z]+)/state"
    replacement = "${2}"
    result_key = "sensor_type"

# Map device_id to friendly names and rooms
[[processors.enum]]
  [[processors.enum.mapping]]
    tag = "device_id"
    dest = "device_name"
    [processors.enum.mapping.value_mappings]
      "33FA4381ECA1010A" = "studio_5051_down"
      "17A8D003C1061976" = "h6076_1976"

  [[processors.enum.mapping]]
    tag = "device_id"
    dest = "room"
    [processors.enum.mapping.value_mappings]
      "33FA4381ECA1010A" = "studown"
      "17A8D003C1061976" = "unassigned"
```

**Auto-generated**: Device mappings updated hourly by `scripts/update-device-map.sh` which queries govee2mqtt API at localhost:8056.

### Planned Phase 4 Structure (Cloud + BLE)

Will add second MQTT input for BLE topics with `source = "ble"` tag, keeping existing cloud input with `source = "cloud"` tag. Both write to same measurement with same tags (device_name, room, sensor_type) plus source differentiator.

---

## DOCKER OPERATIONS

### docker-compose.yml

```yaml
version: '3.8'
services:
  govee2mqtt:
    image: ghcr.io/wez/govee2mqtt:latest
    container_name: govee2mqtt
    restart: unless-stopped
    env_file: .env
    network_mode: host              # Required for AWS IoT
    volumes:
      - govee2mqtt-data:/data

  mosquitto:
    image: eclipse-mosquitto:2
    container_name: mosquitto
    restart: unless-stopped
    ports:
      - "1883:1883"
    volumes:
      - ./mosquitto/config/mosquitto.conf:/mosquitto/config/mosquitto.conf

  telegraf:
    image: telegraf:latest
    container_name: telegraf
    restart: unless-stopped
    volumes:
      - ./telegraf/telegraf.conf:/etc/telegraf/telegraf.conf:ro

  influxdb:
    image: influxdb:2
    container_name: influxdb
    restart: unless-stopped
    ports:
      - "8086:8086"
    volumes:
      - influxdb-data:/var/lib/influxdb2
    environment:
      - DOCKER_INFLUXDB_INIT_MODE=setup
      - DOCKER_INFLUXDB_INIT_USERNAME=admin
      - DOCKER_INFLUXDB_INIT_PASSWORD=influxpass123
      - DOCKER_INFLUXDB_INIT_ORG=home
      - DOCKER_INFLUXDB_INIT_BUCKET=govee
      - DOCKER_INFLUXDB_INIT_ADMIN_TOKEN=my-super-secret-token

  grafana:
    image: grafana/grafana:latest
    container_name: grafana
    restart: unless-stopped
    ports:
      - "3000:3000"
    volumes:
      - grafana-data:/var/lib/grafana

volumes:
  govee2mqtt-data:
  influxdb-data:
  grafana-data:
```

### Volume Naming
Docker volumes are prefixed with directory name:
- `dpx_govee_stack_grafana-data`
- `dpx_govee_stack_influxdb-data`
- `dpx_govee_stack_govee2mqtt-data`

**CRITICAL**: Renaming directory creates NEW volumes = data loss. Use `iot backup` first.

### Operations
- `/etc/docker/daemon.json`: `{"ipv6": false, "fixed-cidr-v6": ""}`
- Docker bridge sometimes goes DOWN after network changes, fix: `sudo systemctl restart docker`
- Full recreate needed for .env changes: `docker compose down && docker compose up -d`
- Restart sufficient for telegraf.conf changes: `docker compose restart telegraf`
- **Logs are lost on container recreate** (down/up cycle) - use `iot restart` when possible

---

## CRON JOBS

Device map update runs hourly:
```bash
0 * * * * /home/dubpixel/dpx_govee_stack/scripts/update-device-map.sh
```

Enable/disable:
```bash
iot cron-on   # Enable hourly updates
iot cron-off  # Disable cron job
```

---

## INSTALLED SERVICES

| Service | Status | Purpose |
|---------|--------|---------|
| SSH | enabled | Remote access |
| avahi-daemon | enabled | mDNS (*.local hostnames) |
| cloudflared | installed | Cloudflare tunnels (manual start) |
| tailscale | enabled | Mesh VPN |
| Docker | enabled | Container runtime |

---

## THEENGS GATEWAY (Windows NUC)

**Current Setup:**
- Installed via pip on Windows with VS 2022 Build Tools C++
- Run manually: `python -m TheengsGateway -H 192.168.1.100 -P 1883`
- Not a service yet, run manually in PowerShell
- H5051 NOT supported by Theengs decoder natively
- Raw manufacturerdata published to MQTT: `home/TheengsGateway/BTtoMQTT/{MAC}`
- Needs custom decoder (ble_decoder.py) on VM to parse

**Phase 4 Tasks:**
- Keep using Theengs on Windows (already working)
- Deploy ble_decoder.py as systemd service on VM
- Subscribe to `home/TheengsGateway/BTtoMQTT/#`
- Decode and republish to `govee/ble/{room}/{metric}`

---

## PHASE 3 COMPLETED WORK

### Documentation Created
- **README.md**: Quick start guide, commands, troubleshooting
- **ARCHITECTURE.md**: Data flows, MQTT topics, decode formats, technical details
- **ROADMAP.md**: Phase tracking, timeline, success metrics
- **CHANGELOG.md**: Version history
- **docs/GRAFANA_SETUP.md**: Manual Grafana datasource and dashboard setup

### File Organization
- Moved scripts to `scripts/` directory
- Created `docs/` directory for documentation
- Updated all path references in scripts and wrapper
- Fixed `iot` command wrapper (not symlink)
- Updated cron job paths

### Git & GitHub
- Initialized git repository
- Created comprehensive .gitignore
- Committed all work with detailed messages
- Pushed to public GitHub: https://github.com/dubpixel/dpx_showsite_ops
- Repository naming: underscores (dpx_showsite_ops) to match existing 80+ repos

### Testing & Validation
- All `iot` commands tested and working
- Device mapping updates working (hourly cron)
- Paths resolved correctly after reorganization
- Stack survives restart
- Backup process verified

---

## PHASE 4 - BLE GATEWAY INTEGRATION (NEXT)

### Goals
- Real-time sensor data (<5 second latency)
- Dual-source data (cloud + BLE)
- No dependency on Govee cloud uptime
- Better debugging (see raw sensor broadcasts)

### Tasks

#### 4.1: Deploy ble_decoder.py as systemd service
**File already exists** at: `~/dpx_govee_stack/scripts/ble_decoder.py` (needs verification/update)

Create systemd service:
```bash
sudo tee /etc/systemd/system/ble-decoder.service << 'EOF'
[Unit]
Description=Govee BLE Decoder
After=network.target mosquitto.service

[Service]
Type=simple
User=dubpixel
WorkingDirectory=/home/dubpixel/dpx_govee_stack/scripts
ExecStart=/usr/bin/python3 /home/dubpixel/dpx_govee_stack/scripts/ble_decoder.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

sudo systemctl daemon-reload
sudo systemctl enable ble-decoder
sudo systemctl start ble-decoder
```

#### 4.2: Update Telegraf Config
Add BLE input alongside cloud input:

```toml
# BLE source input (add this)
[[inputs.mqtt_consumer]]
  servers = ["tcp://mosquitto:1883"]
  topics = [
    "govee/ble/+/temperature",
    "govee/ble/+/humidity",
    "govee/ble/+/battery"
  ]
  data_format = "value"
  data_type = "float"
  topic_tag = "topic"
  [inputs.mqtt_consumer.tags]
    source = "ble"

# Cloud source (existing - add source tag)
[[inputs.mqtt_consumer]]
  servers = ["tcp://mosquitto:1883"]
  topics = [
    "gv2mqtt/sensor/+/state"
  ]
  data_format = "value"
  data_type = "float"
  topic_tag = "topic"
  [inputs.mqtt_consumer.tags]
    source = "cloud"
```

**Note**: This requires updating `scripts/update-device-map.sh` to generate unified config with both inputs.

#### 4.3: Update Grafana Dashboards
- Add source filter to queries
- Show both cloud and BLE data on same graphs
- Add latency comparison panel
- Add source selector variable

#### 4.4: Testing
```bash
# Verify Theengs is publishing
iot mqtt "home/TheengsGateway/BTtoMQTT/#" 10

# Verify decoder is running
sudo systemctl status ble-decoder
journalctl -u ble-decoder -f

# Verify decoded topics
iot mqtt "govee/ble/#" 10

# Check data in InfluxDB
iot query 5m 20 | grep source

# Verify both sources in Grafana
```

---

## PHASE 5 - NETWORK DEVICE BACKUPS (AFTER PHASE 4)

### Goals
- Automated daily backups of M4300 switch configs
- TFTP server for switch config uploads
- Version controlled config history
- Monitoring and alerting

### Tasks

#### 5.1: TFTP Server Setup
Add to docker-compose.yml:
```yaml
  tftp:
    image: pghalliday/tftp
    container_name: tftp
    restart: unless-stopped
    ports:
      - "69:69/udp"
    volumes:
      - ./tftp-data:/var/tftpboot
    environment:
      - TFTP_OPTIONS=--secure --create
```

#### 5.2: M4300 Backup Scripts
- Pull existing m4300-scripts repository
- Integrate with stack
- Schedule via cron
- Git commit configs after each backup

#### 5.3: Monitoring
- Track backup success/failure in InfluxDB
- Grafana dashboard for backup status
- Optional: Slack/email alerts on failures

---

## KEY LEARNINGS / GOTCHAS

- govee2mqtt publishes to `gv2mqtt/#` NOT `govee2mqtt/#`
- Govee API requires devices assigned to rooms to return data
- `RUST_LOG` env changes need full `down/up` cycle, not just restart
- **IPv6 on host causes govee2mqtt timeouts** — disable with sysctl
- Docker daemon.json IPv6 disable doesn't help govee2mqtt (uses `network_mode: host`)
- MQTT wildcard `+` catches non-numeric topics causing parse errors (harmless)
- govee2mqtt web API at port 8056 returns device JSON
- H5051 is BLE only, no LAN/IoT API
- **InfluxDB timestamps are UTC** — adjust for local timezone
- **Docker logs lost on recreate** — use `iot restart` not `down/up`
- **Hourly cron restarts Telegraf** if config changed
- **iot command needs wrapper script** not direct symlink
- **Underscores in hostnames are invalid** (RFC) — use dashes
- **Directory rename breaks Docker volumes** — backup first
- Sensor broadcast: BLE every ~1min, cloud upload every ~10min
- GitHub repo naming: use underscores to match existing projects

---

## GRAFANA SETUP (Manual Steps)

### Connect InfluxDB Datasource
1. Open Grafana: http://192.168.1.100:3000 (admin/grafanapass123)
2. Configuration → Data sources → Add data source → InfluxDB
3. Configure:
   - Query Language: **Flux**
   - URL: **http://influxdb:8086**
   - Organization: **home**
   - Token: **my-super-secret-token**
   - Default Bucket: **govee**
4. Save & Test

### Create Dashboard
Query to see room names:
```flux
from(bucket: "govee")
  |> range(start: -1h)
  |> filter(fn: (r) => r._measurement == "mqtt_consumer")
  |> keep(columns: ["room"])
  |> distinct(column: "room")
```

Temperature panel:
```flux
from(bucket: "govee")
  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
  |> filter(fn: (r) => r.sensor_type == "temperature")
  |> filter(fn: (r) => r.room == "studown")
```

Humidity panel:
```flux
from(bucket: "govee")
  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
  |> filter(fn: (r) => r.sensor_type == "humidity")
  |> filter(fn: (r) => r.room == "studown")
```

Full guide: `docs/GRAFANA_SETUP.md`

---

## QUICK REFERENCE

### Start/Stop Stack
```bash
iot up                          # Start everything
iot down                        # Stop everything
iot restart [service]           # Restart service(s)
iot status                      # Show status
```

### Monitor Data Flow
```bash
iot mqtt "gv2mqtt/#" 10         # Watch cloud topics
iot mqtt "govee/ble/#" 10       # Watch BLE topics (Phase 4)
iot query 1h 10                 # Query recent data
iot lt                          # Check telegraf logs
```

### Maintenance
```bash
iot backup                      # Backup volumes
iot update                      # Update device mappings
iot cron-on                     # Enable hourly updates
git add -A && git commit -m "..." && git push  # Push changes
```

### Troubleshooting
```bash
iot lg                          # govee2mqtt logs
iot validate                    # Check configuration
docker ps                       # Verify containers running
iot web                         # Show service URLs
```

---

## FILES TO CHECK/UPDATE FOR PHASE 4

1. **scripts/ble_decoder.py** - Verify exists and is correct
2. **scripts/update-device-map.sh** - Update to generate unified telegraf config with BLE input
3. **telegraf/telegraf.conf** - Will be regenerated with both inputs
4. **Create**: `/etc/systemd/system/ble-decoder.service`
5. **Update**: Grafana dashboards to show source tag

---

## NEXT STEPS FOR PHASE 4

1. Verify ble_decoder.py script exists and is correct
2. Create systemd service for ble_decoder.py
3. Test Theengs → ble_decoder → MQTT flow
4. Update update-device-map.sh to generate unified Telegraf config
5. Restart Telegraf with new config
6. Verify data flowing with source tags
7. Update Grafana dashboards
8. Test and document
9. Update CHANGELOG and push to GitHub

**Timeline**: Phase 4 starting immediately after Phase 3 (2025-02-05)

---

## CONTACT & CREDENTIALS SUMMARY

- **Server**: dubpixel@dpx-showsite-ops (192.168.1.100)
- **GitHub**: https://github.com/dubpixel/dpx_showsite_ops
- **Git User**: i@dubpixel.tv / dubpixel
- **Govee**: your-govee-email@example.com / (see .env)
- **All service passwords**: See .env file (not tracked in git)

---

**END OF PHASE 3 CONTEXT**
**READY FOR PHASE 4: BLE GATEWAY INTEGRATION**
